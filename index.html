<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Минута дыхания</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: #000;
            color: #fff;
            font-family: 'Segoe UI', 'Helvetica Neue', sans-serif;
            overflow: hidden;
            touch-action: none;
        }

        .app-container {
            position: relative;
            width: 340px;
            height: 580px;
            background: linear-gradient(145deg, #0c0c14, #1a1a2e, #16213e);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 25px 60px rgba(0, 0, 0, 0.7);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            box-sizing: border-box;
            z-index: 10;
            border: 1px solid rgba(100, 200, 255, 0.2);
        }

        .title {
            font-size: 26px;
            font-weight: 700;
            margin-top: 20px;
            margin-bottom: 30px;
            text-align: center;
            background: linear-gradient(90deg, #00c853, #43d8be, #00c853);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            background-size: 200% 100%;
            animation: shine 3s linear infinite;
            letter-spacing: -0.5px;
        }

        @keyframes shine {
            0% { background-position: 0% 50%; }
            100% { background-position: 200% 50%; }
        }

        .breathing-circle-container {
            width: 240px;
            height: 240px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 20px 0;
            position: relative;
        }

        .ring {
            position: absolute;
            width: 100%;
            height: 100%;
            border: 2px solid rgba(66, 214, 164, 0.3);
            border-radius: 50%;
            opacity: 0;
            animation: pulse-ring 2s infinite;
        }

        .ring:nth-child(2) { animation-delay: 0.4s; }
        .ring:nth-child(3) { animation-delay: 0.8s; }

        @keyframes pulse-ring {
            0% {
                transform: scale(0.8);
                opacity: 0.8;
            }
            100% {
                transform: scale(1.4);
                opacity: 0;
            }
        }

        .breathing-circle {
            width: 80px;
            height: 80px;
            background: radial-gradient(circle, #00c853 0%, rgba(0, 200, 83, 0.3) 70%, rgba(0, 200, 83, 0.1) 100%);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            border: 1px solid rgba(100, 255, 180, 0.5);
            box-shadow: 
                0 0 20px rgba(0, 200, 83, 0.6),
                0 0 40px rgba(0, 200, 83, 0.4),
                inset 0 0 15px rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            z-index: 10;
            overflow: hidden;
        }

        .inner-glow {
            width: 60%;
            height: 60%;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.6);
        }

        .breathing-circle.inhale {
            animation: inflate 4s linear forwards;
        }

        .breathing-circle.hold {
            animation: hold 7s linear forwards;
        }

        .breathing-circle.exhale {
            animation: deflate 8s linear forwards;
        }

        @keyframes inflate {
            0% {
                transform: scale(1);
                box-shadow: 0 0 20px rgba(0, 200, 83, 0.6), 0 0 40px rgba(0, 200, 83, 0.4);
            }
            100% {
                transform: scale(2.2);
                box-shadow: 0 0 30px rgba(0, 200, 83, 0.8), 0 0 60px rgba(0, 200, 83, 0.6);
            }
        }

        @keyframes hold {
            0% {
                transform: scale(2.2);
                filter: brightness(1.1);
            }
            100% {
                transform: scale(2.2);
                filter: brightness(1.2);
                box-shadow: 0 0 35px rgba(0, 200, 83, 0.9), 0 0 70px rgba(0, 200, 83, 0.7);
            }
        }

        @keyframes deflate {
            0% {
                transform: scale(2.2);
                box-shadow: 0 0 35px rgba(0, 200, 83, 0.9), 0 0 70px rgba(0, 200, 83, 0.7);
            }
            100% {
                transform: scale(1);
                box-shadow: 0 0 20px rgba(0, 200, 83, 0.6), 0 0 40px rgba(0, 200, 83, 0.4);
            }
        }

        .instruction {
            font-size: 20px;
            margin: 20px 0;
            font-weight: 600;
            min-height: 30px;
            text-align: center;
            background: linear-gradient(90deg, #a8e6cf, #00c853, #a8e6cf);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            background-size: 200% auto;
            animation: textShine 3s linear infinite;
        }

        @keyframes textShine {
            0% { background-position: 0% 50%; }
            100% { background-position: 200% 50%; }
        }

        .timer {
            font-size: 56px;
            font-weight: bold;
            color: #fff;
            margin: 10px 0;
            text-shadow: 0 0 10px rgba(0, 200, 83, 0.7);
        }

        button {
            padding: 16px 32px;
            background: linear-gradient(90deg, #00c853, #43d8be);
            color: white;
            border: none;
            border-radius: 14px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 
                0 5px 15px rgba(0, 200, 83, 0.4),
                0 0 20px rgba(66, 214, 164, 0.3) inset;
            margin-top: 20px;
            transition: all 0.2s;
            letter-spacing: 0.5px;
        }

        button:active {
            transform: translateY(2px);
            box-shadow: 0 3px 10px rgba(0, 200, 83, 0.4);
        }

        .share-btn {
            background: linear-gradient(90deg, #1976d2, #4fc3f7);
        }

        .share-btn:active {
            transform: translateY(2px);
        }

        .stats {
            margin-top: 25px;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.6);
            text-align: center;
        }

        .wave {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100px;
            background: url('data:image/svg+xml;utf8,<svg viewBox="0 0 1440 320" xmlns="http://www.w3.org/2000/svg"><path fill="rgba(0, 200, 83, 0.1)" fill-opacity="1" d="M0,192L48,197.3C96,203,192,213,288,208C384,203,480,181,576,181.3C672,181,768,203,864,213.3C960,224,1056,224,1152,202.7C1248,181,1344,139,1392,117.3L1440,96L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>');
            background-size: cover;
            background-repeat: no-repeat;
            opacity: 0.3;
            animation: wave 10s linear infinite;
            pointer-events: none;
        }

        @keyframes wave {
            0% { background-position-x: 0; }
            100% { background-position-x: 1440px; }
        }

        .particles {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: rgba(66, 214, 164, 0.6);
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(66, 214, 164, 0.8);
            opacity: 0;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="particles" id="particles"></div>
        <div class="wave"></div>

        <div class="title">Минута дыхания</div>

        <div class="breathing-circle-container">
            <div class="ring"></div>
            <div class="ring"></div>
            <div class="ring"></div>
            <div class="breathing-circle" id="circle">
                <div class="inner-glow"></div>
            </div>
        </div>

        <div class="instruction" id="instruction">Готовы начать?</div>
        <div class="timer" id="timer">0</div>

        <button id="startBtn">Начать дыхание</button>
        <button id="shareBtn" class="share-btn" style="display:none">Поделиться</button>

        <div class="stats">
            Сегодня вы дышали <span id="sessionCount">0</span> раз
        </div>
    </div>

    <script>
        const tg = window.Telegram?.WebApp;
        tg.expand();
        tg.ready();

        const circle = document.getElementById('circle');
        const instruction = document.getElementById('instruction');
        const timer = document.getElementById('timer');
        const startBtn = document.getElementById('startBtn');
        const shareBtn = document.getElementById('shareBtn');
        const sessionCountEl = document.getElementById('sessionCount');
        const particlesContainer = document.getElementById('particles');

        let sessionCount = parseInt(localStorage.getItem('breathSessions') || '0');
        sessionCountEl.textContent = sessionCount;

        let isRunning = false;
        let interval;

        // Создание частиц
        function createParticle() {
            const p = document.createElement('div');
            p.classList.add('particle');
            p.style.left = Math.random() * 100 + 'vw';
            p.style.top = Math.random() * 100 + 'vh';
            particlesContainer.appendChild(p);

            // Анимация
            const anim = p.animate([
                { transform: 'translate(0, 0) scale(0)', opacity: 0 },
                { transform: 'translate(' + (Math.random() - 0.5)*50 + 'px, ' + (Math.random() - 0.5)*50 + 'px) scale(1)', opacity: 0.8 },
                { transform: 'translate(' + (Math.random() - 0.5)*100 + 'px, ' + (Math.random() - 0.5)*100 + 'px) scale(0)', opacity: 0 }
            ], {
                duration: 3000 + Math.random() * 2000,
                easing: 'cubic-bezier(0.2, 0.8, 0.8, 0.2)',
                fill: 'forwards'
            });

            anim.onfinish = () => p.remove();
        }

        // Каждые 500мс — новая частица
        setInterval(createParticle, 500);

        const phases = {
            inhale: { time: 4, text: 'Вдох', class: 'inhale' },
            hold: { time: 7, text: 'Задержка', class: 'hold' },
            exhale: { time: 8, text: 'Выдох', class: 'exhale' }
        };

        function startBreathing() {
            if (isRunning) return;
            isRunning = true;
            startBtn.textContent = 'Идёт дыхание...';
            shareBtn.style.display = 'none';

            const sequence = ['inhale', 'hold', 'exhale'];
            let phaseIndex = 0;

            function nextPhase() {
                if (phaseIndex >= sequence.length) {
                    finishBreathing();
                    return;
                }

                const phaseKey = sequence[phaseIndex];
                const phase = phases[phaseKey];

                timeLeft = phase.time;
                instruction.textContent = phase.text;
                timer.textContent = timeLeft;
                circle.className = 'breathing-circle ' + phase.class;

                clearInterval(interval);
                interval = setInterval(() => {
                    timeLeft--;
                    timer.textContent = timeLeft;

                    if (timeLeft <= 0) {
                        phaseIndex++;
                        nextPhase();
                    }
                }, 1000);
            }

            nextPhase();
        }

        function finishBreathing() {
            isRunning = false;
            clearInterval(interval);
            circle.className = 'breathing-circle';
            instruction.textContent = 'Отлично! Вы только что сделали осознанное дыхание.';
            timer.textContent = '0';
            startBtn.textContent = 'Повторить';
            shareBtn.style.display = 'block';

            sessionCount++;
            sessionCountEl.textContent = sessionCount;
            localStorage.setItem('breathSessions', sessionCount);

            if (navigator.vibrate) {
                navigator.vibrate([200]);
            }
        }

        function shareResult() {
            const text = `Я только что сделал осознанное дыхание по методу 4-7-8. Это помогает снять стресс и сосредоточиться. Попробуй и ты!`;
            const url = 'https://t.me/your_bot_name'; // замените на ваш бот
            tg.openTelegramLink(`https://t.me/share/url?url=${encodeURIComponent(url)}&text=${encodeURIComponent(text)}`);
        }

        startBtn.addEventListener('click', startBreathing);
        shareBtn.addEventListener('click', shareResult);
    </script>
</body>
</html>
